script(src='https://cdn.jsdelivr.net/npm/leancloud-storage@latest/dist/av-min.js')
script(src='https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js')

script.
  window.onload = function() {
    let GUEST_INFO = ['nick', 'mail', 'link'];
    let guest_info = '!{ theme.valine.meta }';

    guest_info = guest_info.split(',').filter(function(item) {
      return GUEST_INFO.indexOf(item) > -1;
    });

    new Valine({
      el: '#comments',
      appId: '!{ theme.valine.appid }',
      appKey: '!{ theme.valine.appkey }',
      notify: !{ theme.valine.notify },
      verify: !{ theme.valine.verify },
      placeholder: '!{ theme.valine.placeholder }',
      avatar: '!{ theme.valine.avatar }',
      meta: guest_info,
      pageSize: '!{ theme.valine.pageSize }' || 10,
      visitor: !{ theme.valine.visitor },
      recordIP: !{ theme.valine.recordIP },
      lang: '!{ theme.valine.language }' || 'zh-cn'
    });
  };
